<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from vinayaroratech.com/dotnet/getting-started-with-opentelemetry-metrics-in-net-part-2-instrumenting-the-bookstore-api/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 08:24:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="https://gmpg.org/xfn/11">

<title>Getting started with OpenTelemetry Metrics in .NET. Part 2: Instrumenting the BookStore API &#8211; Vinay Arora</title>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='http://www.googletagmanager.com/' />
<link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Vinay Arora &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Vinay Arora &raquo; Comments Feed" href="../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Vinay Arora &raquo; Getting started with OpenTelemetry Metrics in .NET. Part 2: Instrumenting the BookStore API Comments Feed" href="feed/index.html" />
		<script>
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/vinayaroratech.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.8"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style>
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='astra-theme-css-css'  href='../../wp-content/themes/astra/assets/css/minified/frontend.minb045.css?ver=3.4.8' media='all' />
<style id='astra-theme-css-inline-css'>
html{font-size:93.75%;}a,.page-title{color:#d94948;}a:hover,a:focus{color:#000000;}body,button,input,select,textarea,.ast-button,.ast-custom-button{font-family:'Montserrat',sans-serif;font-weight:400;font-size:15px;font-size:1rem;text-transform:none;}blockquote{color:rgba(1,22,39,0.75);}h1,.entry-content h1,h2,.entry-content h2,h3,.entry-content h3,h4,.entry-content h4,h5,.entry-content h5,h6,.entry-content h6,.site-title,.site-title a{font-family:'Montserrat',sans-serif;font-weight:700;}.site-title{font-size:28px;font-size:1.8666666666667rem;}header .custom-logo-link img{max-width:90px;}.astra-logo-svg{width:90px;}.ast-archive-description .ast-archive-title{font-size:40px;font-size:2.6666666666667rem;}.site-header .site-description{font-size:15px;font-size:1rem;}.entry-title{font-size:30px;font-size:2rem;}h1,.entry-content h1{font-size:70px;font-size:4.6666666666667rem;font-family:'Montserrat',sans-serif;text-transform:uppercase;}h2,.entry-content h2{font-size:34px;font-size:2.2666666666667rem;font-family:'Montserrat',sans-serif;line-height:1.2;text-transform:none;}h3,.entry-content h3{font-size:23px;font-size:1.5333333333333rem;font-family:'Montserrat',sans-serif;line-height:1.5;text-transform:none;}h4,.entry-content h4{font-size:16px;font-size:1.0666666666667rem;}h5,.entry-content h5{font-size:14px;font-size:0.93333333333333rem;}h6,.entry-content h6{font-size:12px;font-size:0.8rem;}.ast-single-post .entry-title,.page-title{font-size:40px;font-size:2.6666666666667rem;}::selection{background-color:#d94948;color:#ffffff;}body,h1,.entry-title a,.entry-content h1,h2,.entry-content h2,h3,.entry-content h3,h4,.entry-content h4,h5,.entry-content h5,h6,.entry-content h6{color:rgba(1,22,39,0.75);}.tagcloud a:hover,.tagcloud a:focus,.tagcloud a.current-item{color:#ffffff;border-color:#d94948;background-color:#d94948;}input:focus,input[type="text"]:focus,input[type="email"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="reset"]:focus,input[type="search"]:focus,textarea:focus{border-color:#d94948;}input[type="radio"]:checked,input[type=reset],input[type="checkbox"]:checked,input[type="checkbox"]:hover:checked,input[type="checkbox"]:focus:checked,input[type=range]::-webkit-slider-thumb{border-color:#d94948;background-color:#d94948;box-shadow:none;}.site-footer a:hover + .post-count,.site-footer a:focus + .post-count{background:#d94948;border-color:#d94948;}.single .nav-links .nav-previous,.single .nav-links .nav-next{color:#d94948;}.entry-meta,.entry-meta *{line-height:1.45;color:#d94948;}.entry-meta a:hover,.entry-meta a:hover *,.entry-meta a:focus,.entry-meta a:focus *,.page-links > .page-link,.page-links .page-link:hover,.post-navigation a:hover{color:#000000;}.widget-title{font-size:21px;font-size:1.4rem;color:rgba(1,22,39,0.75);}#cat option,.secondary .calendar_wrap thead a,.secondary .calendar_wrap thead a:visited{color:#d94948;}.secondary .calendar_wrap #today,.ast-progress-val span{background:#d94948;}.secondary a:hover + .post-count,.secondary a:focus + .post-count{background:#d94948;border-color:#d94948;}.calendar_wrap #today > a{color:#ffffff;}.page-links .page-link,.single .post-navigation a{color:#d94948;}.ast-header-break-point .main-header-bar .ast-button-wrap .menu-toggle{border-radius:0px;}.wp-block-buttons.aligncenter{justify-content:center;}@media (max-width:782px){.entry-content .wp-block-columns .wp-block-column{margin-left:0px;}}@media (max-width:921px){.ast-separate-container .ast-article-post,.ast-separate-container .ast-article-single{padding:1.5em 2.14em;}.ast-separate-container #primary,.ast-separate-container #secondary{padding:1.5em 0;}#primary,#secondary{padding:1.5em 0;margin:0;}.ast-left-sidebar #content > .ast-container{display:flex;flex-direction:column-reverse;width:100%;}.ast-author-box img.avatar{margin:20px 0 0 0;}}@media (min-width:922px){.ast-separate-container.ast-right-sidebar #primary,.ast-separate-container.ast-left-sidebar #primary{border:0;}.search-no-results.ast-separate-container #primary{margin-bottom:4em;}}.elementor-button-wrapper .elementor-button{border-style:solid;border-top-width:0;border-right-width:0;border-left-width:0;border-bottom-width:0;}body .elementor-button.elementor-size-sm,body .elementor-button.elementor-size-xs,body .elementor-button.elementor-size-md,body .elementor-button.elementor-size-lg,body .elementor-button.elementor-size-xl,body .elementor-button{border-radius:100px;padding-top:16px;padding-right:30px;padding-bottom:16px;padding-left:30px;}.elementor-button-wrapper .elementor-button{border-color:#d94948;background-color:#d94948;}.elementor-button-wrapper .elementor-button:hover,.elementor-button-wrapper .elementor-button:focus{color:#ffffff;background-color:rgba(217,73,72,0.85);border-color:rgba(217,73,72,0.85);}.wp-block-button .wp-block-button__link,.elementor-button-wrapper .elementor-button,.elementor-button-wrapper .elementor-button:visited{color:#ffffff;}.elementor-button-wrapper .elementor-button{font-family:inherit;font-weight:600;line-height:1;text-transform:uppercase;}.wp-block-button .wp-block-button__link:hover,.wp-block-button .wp-block-button__link:focus{color:#ffffff;background-color:rgba(217,73,72,0.85);border-color:rgba(217,73,72,0.85);}.elementor-widget-heading h2.elementor-heading-title{line-height:1.2;}.elementor-widget-heading h3.elementor-heading-title{line-height:1.5;}.wp-block-button .wp-block-button__link{border-style:solid;border-top-width:0;border-right-width:0;border-left-width:0;border-bottom-width:0;border-color:#d94948;background-color:#d94948;color:#ffffff;font-family:inherit;font-weight:600;line-height:1;text-transform:uppercase;border-radius:100px;padding-top:16px;padding-right:30px;padding-bottom:16px;padding-left:30px;}.menu-toggle,button,.ast-button,.ast-custom-button,.button,input#submit,input[type="button"],input[type="submit"],input[type="reset"]{border-style:solid;border-top-width:0;border-right-width:0;border-left-width:0;border-bottom-width:0;color:#ffffff;border-color:#d94948;background-color:#d94948;border-radius:100px;padding-top:16px;padding-right:30px;padding-bottom:16px;padding-left:30px;font-family:inherit;font-weight:600;line-height:1;text-transform:uppercase;}button:focus,.menu-toggle:hover,button:hover,.ast-button:hover,.ast-custom-button:hover .button:hover,.ast-custom-button:hover ,input[type=reset]:hover,input[type=reset]:focus,input#submit:hover,input#submit:focus,input[type="button"]:hover,input[type="button"]:focus,input[type="submit"]:hover,input[type="submit"]:focus{color:#ffffff;background-color:rgba(217,73,72,0.85);border-color:rgba(217,73,72,0.85);}@media (min-width:544px){.ast-container{max-width:100%;}}@media (max-width:544px){.ast-separate-container .ast-article-post,.ast-separate-container .ast-article-single,.ast-separate-container .comments-title,.ast-separate-container .ast-archive-description{padding:1.5em 1em;}.ast-separate-container #content .ast-container{padding-left:0.54em;padding-right:0.54em;}.ast-separate-container .ast-comment-list li.depth-1{padding:1.5em 1em;margin-bottom:1.5em;}.ast-separate-container .ast-comment-list .bypostauthor{padding:.5em;}.ast-search-menu-icon.ast-dropdown-active .search-field{width:170px;}}@media (max-width:544px){.ast-separate-container .comments-count-wrapper{padding:1.5em 1em;}.ast-separate-container .ast-comment-list li.depth-1{padding:1.5em 1em;margin-bottom:1.5em;}.ast-separate-container .ast-comment-list .bypostauthor{padding:.5em;}.ast-separate-container .comment-respond{padding:1.5em 1em;}}@media (max-width:544px){.ast-comment-list .children{margin-left:0.66666em;}.ast-separate-container .ast-comment-list .bypostauthor li{padding:0 0 0 .5em;}}@media (max-width:921px){.ast-mobile-header-stack .main-header-bar .ast-search-menu-icon{display:inline-block;}.ast-header-break-point.ast-header-custom-item-outside .ast-mobile-header-stack .main-header-bar .ast-search-icon{margin:0;}.ast-comment-avatar-wrap img{max-width:2.5em;}.ast-separate-container .ast-comment-list li.depth-1{padding:1.5em 2.14em;}.ast-separate-container .comment-respond{padding:2em 2.14em;}.ast-comment-meta{padding:0 1.8888em 1.3333em;}}@media (max-width:921px){.ast-comment-avatar-wrap img{max-width:2.5em;}.comments-area{margin-top:1.5em;}.ast-separate-container .comments-count-wrapper{padding:2em 2.14em;}.ast-separate-container .ast-comment-list li.depth-1{padding:1.5em 2.14em;}.ast-separate-container .comment-respond{padding:2em 2.14em;}}@media (max-width:921px){.ast-comment-avatar-wrap{margin-right:0.5em;}}@media (max-width:921px){.ast-archive-description .ast-archive-title{font-size:40px;}.entry-title{font-size:30px;}h1,.entry-content h1{font-size:70px;}h2,.entry-content h2{font-size:40px;}h3,.entry-content h3{font-size:23px;}h4,.entry-content h4{font-size:18px;font-size:1.2rem;}h5,.entry-content h5{font-size:16px;font-size:1.0666666666667rem;}h6,.entry-content h6{font-size:14px;font-size:0.93333333333333rem;}.ast-single-post .entry-title,.page-title{font-size:30px;}}@media (max-width:544px){.ast-archive-description .ast-archive-title{font-size:40px;}.entry-title{font-size:30px;}h1,.entry-content h1{font-size:33px;}h2,.entry-content h2{font-size:25px;}h3,.entry-content h3{font-size:20px;}h4,.entry-content h4{font-size:14px;font-size:0.93333333333333rem;}h5,.entry-content h5{font-size:13px;font-size:0.86666666666667rem;}h6,.entry-content h6{font-size:12px;font-size:0.8rem;}.ast-single-post .entry-title,.page-title{font-size:25px;}.ast-header-break-point .site-branding img,.ast-header-break-point .custom-logo-link img{max-width:74px;}.astra-logo-svg{width:74px;}.ast-header-break-point .site-logo-img .custom-mobile-logo-link img{max-width:74px;}}@media (max-width:921px){html{font-size:85.5%;}}@media (max-width:544px){html{font-size:85.5%;}}@media (min-width:922px){.ast-container{max-width:1240px;}}@font-face {font-family: "Astra";src: url(../../wp-content/themes/astra/assets/fonts/astra.woff) format("woff"),url(https://vinayaroratech.com/wp-content/themes/astra/assets/fonts/astra.ttf) format("truetype"),url(https://vinayaroratech.com/wp-content/themes/astra/assets/fonts/astra.svg#astra) format("svg");font-weight: normal;font-style: normal;font-display: fallback;}@media (min-width:922px){.main-header-menu .sub-menu .menu-item.ast-left-align-sub-menu:hover > .sub-menu,.main-header-menu .sub-menu .menu-item.ast-left-align-sub-menu.focus > .sub-menu{margin-left:-0px;}}.ast-breadcrumbs .trail-browse,.ast-breadcrumbs .trail-items,.ast-breadcrumbs .trail-items li{display:inline-block;margin:0;padding:0;border:none;background:inherit;text-indent:0;}.ast-breadcrumbs .trail-browse{font-size:inherit;font-style:inherit;font-weight:inherit;color:inherit;}.ast-breadcrumbs .trail-items{list-style:none;}.trail-items li::after{padding:0 0.3em;content:"\00bb";}.trail-items li:last-of-type::after{display:none;}h1,.entry-content h1,h2,.entry-content h2,h3,.entry-content h3,h4,.entry-content h4,h5,.entry-content h5,h6,.entry-content h6{color:#011627;}@media (max-width:921px){.ast-builder-grid-row-container.ast-builder-grid-row-tablet-3-firstrow .ast-builder-grid-row > *:first-child,.ast-builder-grid-row-container.ast-builder-grid-row-tablet-3-lastrow .ast-builder-grid-row > *:last-child{grid-column:1 / -1;}}@media (max-width:544px){.ast-builder-grid-row-container.ast-builder-grid-row-mobile-3-firstrow .ast-builder-grid-row > *:first-child,.ast-builder-grid-row-container.ast-builder-grid-row-mobile-3-lastrow .ast-builder-grid-row > *:last-child{grid-column:1 / -1;}}.ast-builder-layout-element[data-section="title_tagline"]{display:flex;}@media (max-width:921px){.ast-header-break-point .ast-builder-layout-element[data-section="title_tagline"]{display:flex;}}@media (max-width:544px){.ast-header-break-point .ast-builder-layout-element[data-section="title_tagline"]{display:flex;}}.ast-header-button-1[data-section="section-hb-button-1"]{display:flex;}@media (max-width:921px){.ast-header-break-point .ast-header-button-1[data-section="section-hb-button-1"]{display:flex;}}@media (max-width:544px){.ast-header-break-point .ast-header-button-1[data-section="section-hb-button-1"]{display:flex;}}.ast-builder-menu-1{font-family:inherit;font-weight:inherit;}.ast-builder-menu-1 .sub-menu,.ast-builder-menu-1 .inline-on-mobile .sub-menu{border-top-width:2px;border-bottom-width:0;border-right-width:0;border-left-width:0;border-color:#d94948;border-style:solid;border-radius:0;}.ast-builder-menu-1 .main-header-menu > .menu-item > .sub-menu,.ast-builder-menu-1 .main-header-menu > .menu-item > .astra-full-megamenu-wrapper{margin-top:0;}.ast-desktop .ast-builder-menu-1 .main-header-menu > .menu-item > .sub-menu:before,.ast-desktop .ast-builder-menu-1 .main-header-menu > .menu-item > .astra-full-megamenu-wrapper:before{height:calc( 0px + 5px );}.ast-desktop .ast-builder-menu-1 .menu-item .sub-menu .menu-link{border-style:none;}@media (max-width:921px){.ast-header-break-point .ast-builder-menu-1 .menu-item.menu-item-has-children > .ast-menu-toggle{top:0;}.ast-builder-menu-1 .menu-item-has-children > .menu-link:after{content:unset;}}@media (max-width:544px){.ast-header-break-point .ast-builder-menu-1 .menu-item.menu-item-has-children > .ast-menu-toggle{top:0;}}.ast-builder-menu-1{display:flex;}@media (max-width:921px){.ast-header-break-point .ast-builder-menu-1{display:flex;}}@media (max-width:544px){.ast-header-break-point .ast-builder-menu-1{display:flex;}}.site-below-footer-wrap[data-section="section-below-footer-builder"]{background-color:#011627;;background-image:none;;min-height:80px;}.site-below-footer-wrap[data-section="section-below-footer-builder"] .ast-builder-grid-row{max-width:1200px;margin-left:auto;margin-right:auto;}.site-below-footer-wrap[data-section="section-below-footer-builder"] .ast-builder-grid-row,.site-below-footer-wrap[data-section="section-below-footer-builder"] .site-footer-section{align-items:flex-start;}.site-below-footer-wrap[data-section="section-below-footer-builder"].ast-footer-row-inline .site-footer-section{display:flex;margin-bottom:0;}.ast-builder-grid-row-2-equal .ast-builder-grid-row{grid-template-columns:repeat( 2,1fr );}@media (max-width:921px){.site-below-footer-wrap[data-section="section-below-footer-builder"].ast-footer-row-tablet-inline .site-footer-section{display:flex;margin-bottom:0;}.site-below-footer-wrap[data-section="section-below-footer-builder"].ast-footer-row-tablet-stack .site-footer-section{display:block;margin-bottom:10px;}.ast-builder-grid-row-container.ast-builder-grid-row-tablet-2-equal .ast-builder-grid-row{grid-template-columns:repeat( 2,1fr );}}@media (max-width:544px){.site-below-footer-wrap[data-section="section-below-footer-builder"].ast-footer-row-mobile-inline .site-footer-section{display:flex;margin-bottom:0;}.site-below-footer-wrap[data-section="section-below-footer-builder"].ast-footer-row-mobile-stack .site-footer-section{display:block;margin-bottom:10px;}.ast-builder-grid-row-container.ast-builder-grid-row-mobile-full .ast-builder-grid-row{grid-template-columns:1fr;}}.site-below-footer-wrap[data-section="section-below-footer-builder"]{padding-top:30px;padding-bottom:30px;padding-left:30px;padding-right:30px;}.site-below-footer-wrap[data-section="section-below-footer-builder"]{display:grid;}@media (max-width:921px){.ast-header-break-point .site-below-footer-wrap[data-section="section-below-footer-builder"]{display:grid;}}@media (max-width:544px){.ast-header-break-point .site-below-footer-wrap[data-section="section-below-footer-builder"]{display:grid;}}.footer-widget-area[data-section="section-fb-html-1"] .ast-builder-html-element{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="section-fb-html-1"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="section-fb-html-1"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="section-fb-html-1"]{display:block;}}.footer-widget-area[data-section="section-fb-html-1"] .ast-builder-html-element{text-align:right;}@media (max-width:921px){.footer-widget-area[data-section="section-fb-html-1"] .ast-builder-html-element{text-align:right;}}@media (max-width:544px){.footer-widget-area[data-section="section-fb-html-1"] .ast-builder-html-element{text-align:center;}}.ast-footer-copyright{text-align:left;}.ast-footer-copyright {color:rgba(255,255,255,0.75);}@media (max-width:921px){.ast-footer-copyright{text-align:left;}}@media (max-width:544px){.ast-footer-copyright{text-align:center;}}.ast-footer-copyright.ast-builder-layout-element{display:flex;}@media (max-width:921px){.ast-header-break-point .ast-footer-copyright.ast-builder-layout-element{display:flex;}}@media (max-width:544px){.ast-header-break-point .ast-footer-copyright.ast-builder-layout-element{display:flex;}}.site-footer{background-color:#011627;;background-image:none;;}.site-primary-footer-wrap[data-section="section-primary-footer-builder"]{background-image:url(https://vinayaroratech.com/wp-content/uploads/2021/06/bg-10-free-image.jpg);;background-repeat:repeat;background-position:center center;background-size:cover;background-attachment:fixed;border-style:solid;border-width:0px;border-top-width:1px;border-top-color:#e6e6e6;}.site-primary-footer-wrap[data-section="section-primary-footer-builder"] .ast-builder-grid-row{max-width:1200px;margin-left:auto;margin-right:auto;}.site-primary-footer-wrap[data-section="section-primary-footer-builder"] .ast-builder-grid-row,.site-primary-footer-wrap[data-section="section-primary-footer-builder"] .site-footer-section{align-items:flex-start;}.site-primary-footer-wrap[data-section="section-primary-footer-builder"].ast-footer-row-inline .site-footer-section{display:flex;margin-bottom:0;}.ast-builder-grid-row-3-equal .ast-builder-grid-row{grid-template-columns:repeat( 3,1fr );}@media (max-width:921px){.site-primary-footer-wrap[data-section="section-primary-footer-builder"].ast-footer-row-tablet-inline .site-footer-section{display:flex;margin-bottom:0;}.site-primary-footer-wrap[data-section="section-primary-footer-builder"].ast-footer-row-tablet-stack .site-footer-section{display:block;margin-bottom:10px;}.ast-builder-grid-row-container.ast-builder-grid-row-tablet-3-lheavy .ast-builder-grid-row{grid-template-columns:2fr 1fr 1fr;}}@media (max-width:544px){.site-primary-footer-wrap[data-section="section-primary-footer-builder"].ast-footer-row-mobile-inline .site-footer-section{display:flex;margin-bottom:0;}.site-primary-footer-wrap[data-section="section-primary-footer-builder"].ast-footer-row-mobile-stack .site-footer-section{display:block;margin-bottom:10px;}.ast-builder-grid-row-container.ast-builder-grid-row-mobile-full .ast-builder-grid-row{grid-template-columns:1fr;}}.site-primary-footer-wrap[data-section="section-primary-footer-builder"]{padding-top:100px;padding-left:30px;padding-right:30px;}@media (max-width:921px){.site-primary-footer-wrap[data-section="section-primary-footer-builder"]{padding-top:75px;padding-bottom:25px;padding-left:25px;padding-right:25px;}}@media (max-width:544px){.site-primary-footer-wrap[data-section="section-primary-footer-builder"]{padding-top:75px;padding-bottom:55px;padding-left:20px;padding-right:20px;}}.site-primary-footer-wrap[data-section="section-primary-footer-builder"]{display:grid;}@media (max-width:921px){.ast-header-break-point .site-primary-footer-wrap[data-section="section-primary-footer-builder"]{display:grid;}}@media (max-width:544px){.ast-header-break-point .site-primary-footer-wrap[data-section="section-primary-footer-builder"]{display:grid;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .footer-widget-area-inner{text-align:left;}@media (max-width:921px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .footer-widget-area-inner{text-align:left;}}@media (max-width:544px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .footer-widget-area-inner{text-align:left;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .footer-widget-area-inner{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .widget-title{color:#ffffff;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner a{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner a:hover{color:#d94948;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .widget-title{color:#ffffff;}@media (max-width:544px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{margin-bottom:30px;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner a{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner a:hover{color:#d94948;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .widget-title{color:#ffffff;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{margin-top:20px;margin-bottom:20px;margin-left:0px;margin-right:0px;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner{text-align:left;}@media (max-width:921px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner{text-align:left;}}@media (max-width:544px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner{text-align:left;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .footer-widget-area-inner{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .widget-title{color:#ffffff;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner a{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner a:hover{color:#d94948;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .widget-title{color:#ffffff;}@media (max-width:544px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{margin-bottom:30px;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner a{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner a:hover{color:#d94948;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .widget-title{color:#ffffff;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{margin-top:20px;margin-bottom:20px;margin-left:0px;margin-right:0px;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner{text-align:left;}@media (max-width:921px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner{text-align:left;}}@media (max-width:544px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner{text-align:left;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .footer-widget-area-inner{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"] .widget-title{color:#ffffff;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-1"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner a{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .footer-widget-area-inner a:hover{color:#d94948;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"] .widget-title{color:#ffffff;}@media (max-width:544px){.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{margin-bottom:30px;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-2"]{display:block;}}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner a{color:rgba(255,255,255,0.75);}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .footer-widget-area-inner a:hover{color:#d94948;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"] .widget-title{color:#ffffff;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{margin-top:20px;margin-bottom:20px;margin-left:0px;margin-right:0px;}.footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}@media (max-width:921px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}}@media (max-width:544px){.ast-header-break-point .footer-widget-area[data-section="sidebar-widgets-footer-widget-3"]{display:block;}}.elementor-template-full-width .ast-container{display:block;}.ast-header-break-point .main-header-bar{border-bottom-width:0;}@media (min-width:922px){.main-header-bar{border-bottom-width:0;}}.ast-safari-browser-less-than-11 .main-header-menu .menu-item, .ast-safari-browser-less-than-11 .main-header-bar .ast-masthead-custom-menu-items{display:block;}.main-header-menu .menu-item, #astra-footer-menu .menu-item, .main-header-bar .ast-masthead-custom-menu-items{-js-display:flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;}.main-header-menu > .menu-item > .menu-link, #astra-footer-menu > .menu-item > .menu-link,{height:100%;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-js-display:flex;display:flex;}.ast-primary-menu-disabled .main-header-bar .ast-masthead-custom-menu-items{flex:unset;}.header-main-layout-1 .ast-flex.main-header-container, .header-main-layout-3 .ast-flex.main-header-container{-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;}.main-header-menu .sub-menu .menu-item.menu-item-has-children > .menu-link:after{position:absolute;right:1em;top:50%;transform:translate(0,-50%) rotate(270deg);}.ast-header-break-point .main-header-bar .main-header-bar-navigation .page_item_has_children > .ast-menu-toggle::before, .ast-header-break-point .main-header-bar .main-header-bar-navigation .menu-item-has-children > .ast-menu-toggle::before, .ast-mobile-popup-drawer .main-header-bar-navigation .menu-item-has-children>.ast-menu-toggle::before, .ast-header-break-point .ast-mobile-header-wrap .main-header-bar-navigation .menu-item-has-children > .ast-menu-toggle::before{font-weight:bold;content:"\e900";font-family:Astra;text-decoration:inherit;display:inline-block;}.ast-header-break-point .main-navigation ul.sub-menu .menu-item .menu-link:before{content:"\e900";font-family:Astra;font-size:.65em;text-decoration:inherit;display:inline-block;transform:translate(0, -2px) rotateZ(270deg);margin-right:5px;}.widget_search .search-form:after{font-family:Astra;font-size:1.2em;font-weight:normal;content:"\e8b6";position:absolute;top:50%;right:15px;transform:translate(0, -50%);}.astra-search-icon::before{content:"\e8b6";font-family:Astra;font-style:normal;font-weight:normal;text-decoration:inherit;text-align:center;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.main-header-bar .main-header-bar-navigation .page_item_has_children > a:after, .main-header-bar .main-header-bar-navigation .menu-item-has-children > a:after, .site-header-focus-item .main-header-bar-navigation .menu-item-has-children > .menu-link:after{content:"\e900";display:inline-block;font-family:Astra;font-size:.6rem;font-weight:bold;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin-left:10px;line-height:normal;}.ast-mobile-popup-drawer .main-header-bar-navigation .ast-submenu-expanded>.ast-menu-toggle::before{transform:rotateX(180deg);}.ast-header-break-point .main-header-bar-navigation .menu-item-has-children > .menu-link:after{display:none;}.ast-mobile-header-content > *,.ast-desktop-header-content > * {padding: 10px 0;height: auto;}.ast-mobile-header-content > *:first-child,.ast-desktop-header-content > *:first-child {padding-top: 10px;}.ast-mobile-header-content > .ast-builder-menu,.ast-desktop-header-content > .ast-builder-menu {padding-top: 0;}.ast-mobile-header-content > *:last-child,.ast-desktop-header-content > *:last-child {padding-bottom: 0;}.ast-mobile-header-content .ast-search-menu-icon.ast-inline-search label,.ast-desktop-header-content .ast-search-menu-icon.ast-inline-search label {width: 100%;}.ast-desktop-header-content .main-header-bar-navigation .ast-submenu-expanded > .ast-menu-toggle::before {transform: rotateX(180deg);}#ast-desktop-header .ast-desktop-header-content,.ast-mobile-header-content .ast-search-icon,.ast-desktop-header-content .ast-search-icon,.ast-off-canvas-active .ast-main-header-nav-open.ast-popup-nav-open .ast-mobile-header-wrap .ast-mobile-header-content,.ast-mobile-header-wrap .ast-mobile-header-content,.ast-main-header-nav-open.ast-popup-nav-open .ast-mobile-header-wrap .ast-mobile-header-content,.ast-off-canvas-active .ast-main-header-nav-open.ast-popup-nav-open .ast-desktop-header-content,.ast-main-header-nav-open.ast-popup-nav-open .ast-desktop-header-content {display: none;}.ast-main-header-nav-open.ast-header-break-point #ast-desktop-header .ast-desktop-header-content,.ast-main-header-nav-open.ast-header-break-point .ast-mobile-header-wrap .ast-mobile-header-content {display: block;}.ast-desktop .ast-desktop-header-content .astra-menu-animation-slide-up > .menu-item > .sub-menu,.ast-desktop .ast-desktop-header-content .astra-menu-animation-slide-up > .menu-item .menu-item > .sub-menu,.ast-desktop .ast-desktop-header-content .astra-menu-animation-slide-down > .menu-item > .sub-menu,.ast-desktop .ast-desktop-header-content .astra-menu-animation-slide-down > .menu-item .menu-item > .sub-menu,.ast-desktop .ast-desktop-header-content .astra-menu-animation-fade > .menu-item > .sub-menu,.ast-desktop .ast-desktop-header-content .astra-menu-animation-fade > .menu-item .menu-item > .sub-menu {opacity: 1;visibility: visible;}.ast-hfb-header.ast-default-menu-enable.ast-header-break-point .ast-mobile-header-wrap .ast-mobile-header-content .main-header-bar-navigation {width: unset;margin: unset;}.ast-mobile-header-content.content-align-flex-end .main-header-bar-navigation .menu-item-has-children > .ast-menu-toggle,.ast-desktop-header-content.content-align-flex-end .main-header-bar-navigation .menu-item-has-children > .ast-menu-toggle {left: calc( 20px - 0.907em);}.ast-mobile-header-content .ast-search-menu-icon,.ast-mobile-header-content .ast-search-menu-icon.slide-search,.ast-desktop-header-content .ast-search-menu-icon,.ast-desktop-header-content .ast-search-menu-icon.slide-search {width: 100%;position: relative;display: block;right: auto;transform: none;}.ast-mobile-header-content .ast-search-menu-icon.slide-search .search-form,.ast-mobile-header-content .ast-search-menu-icon .search-form,.ast-desktop-header-content .ast-search-menu-icon.slide-search .search-form,.ast-desktop-header-content .ast-search-menu-icon .search-form {right: 0;visibility: visible;opacity: 1;position: relative;top: auto;transform: none;padding: 0;display: block;overflow: hidden;}.ast-mobile-header-content .ast-search-menu-icon.ast-inline-search .search-field,.ast-mobile-header-content .ast-search-menu-icon .search-field,.ast-desktop-header-content .ast-search-menu-icon.ast-inline-search .search-field,.ast-desktop-header-content .ast-search-menu-icon .search-field {width: 100%;padding-right: 5.5em;}.ast-mobile-header-content .ast-search-menu-icon .search-submit,.ast-desktop-header-content .ast-search-menu-icon .search-submit {display: block;position: absolute;height: 100%;top: 0;right: 0;padding: 0 1em;border-radius: 0;}.ast-hfb-header.ast-default-menu-enable.ast-header-break-point .ast-mobile-header-wrap .ast-mobile-header-content .main-header-bar-navigation ul .sub-menu .menu-link {padding-left: 30px;}.ast-hfb-header.ast-default-menu-enable.ast-header-break-point .ast-mobile-header-wrap .ast-mobile-header-content .main-header-bar-navigation .sub-menu .menu-item .menu-item .menu-link {padding-left: 40px;}.ast-mobile-popup-drawer.active .ast-mobile-popup-inner{background-color:#ffffff;;}.ast-mobile-header-wrap .ast-mobile-header-content, .ast-desktop-header-content{background-color:#ffffff;;}.ast-mobile-popup-content > *, .ast-mobile-header-content > *, .ast-desktop-popup-content > *, .ast-desktop-header-content > *{padding-top:0;padding-bottom:0;}.content-align-flex-start .ast-builder-layout-element{justify-content:flex-start;}.content-align-flex-start .main-header-menu{text-align:left;}.ast-mobile-popup-drawer.active .ast-mobile-popup-drawer.active .menu-toggle-close{color:#3a3a3a;}.ast-mobile-header-wrap .ast-primary-header-bar,.ast-primary-header-bar .site-primary-header-wrap{min-height:70px;}.ast-desktop .ast-primary-header-bar .main-header-menu > .menu-item{line-height:70px;}#masthead .ast-container,.site-header-focus-item + .ast-breadcrumbs-wrapper{max-width:100%;padding-left:35px;padding-right:35px;}@media (max-width:921px){#masthead .ast-mobile-header-wrap .ast-above-header-bar,#masthead .ast-mobile-header-wrap .ast-primary-header-bar,#masthead .ast-mobile-header-wrap .ast-below-header-bar{padding-left:20px;padding-right:20px;}}.ast-header-break-point .ast-primary-header-bar{border-bottom-width:0;border-bottom-style:solid;}@media (min-width:922px){.ast-primary-header-bar{border-bottom-width:0;border-bottom-style:solid;}}.ast-primary-header-bar{background-color:#ffffff;;}.ast-primary-header-bar{display:block;}@media (max-width:921px){.ast-header-break-point .ast-primary-header-bar{display:grid;}}@media (max-width:544px){.ast-header-break-point .ast-primary-header-bar{display:grid;}}[data-section="section-header-mobile-trigger"] .ast-button-wrap .ast-mobile-menu-trigger-fill{color:#ffffff;border:none;background:#d94948;border-radius:0;}[data-section="section-header-mobile-trigger"] .ast-button-wrap .mobile-menu-toggle-icon .ast-mobile-svg{width:20px;height:20px;fill:#ffffff;}[data-section="section-header-mobile-trigger"] .ast-button-wrap .mobile-menu-wrap .mobile-menu{color:#ffffff;}.comment-reply-title{font-size:24px;font-size:1.6rem;}.ast-comment-meta{line-height:1.666666667;color:#d94948;font-size:12px;font-size:0.8rem;}.ast-comment-list #cancel-comment-reply-link{font-size:15px;font-size:1rem;}.comments-count-wrapper {padding: 2em 0;}.comments-count-wrapper .comments-title {font-weight: normal;word-wrap: break-word;}.ast-comment-list {margin: 0;word-wrap: break-word;padding-bottom: 0.5em;list-style: none;}.ast-comment-list li {list-style: none;}.ast-comment-list li.depth-1 .ast-comment,.ast-comment-list li.depth-2 .ast-comment {border-bottom: 1px solid #eeeeee;}.ast-comment-list .comment-respond {padding: 1em 0;border-bottom: 1px solid #eeeeee;}.ast-comment-list .comment-respond .comment-reply-title {margin-top: 0;padding-top: 0;}.ast-comment-list .comment-respond p {margin-bottom: .5em;}.ast-comment-list .ast-comment-edit-reply-wrap {-js-display: flex;display: flex;justify-content: flex-end;}.ast-comment-list .ast-edit-link {flex: 1;}.ast-comment-list .comment-awaiting-moderation {margin-bottom: 0;}.ast-comment {padding: 1em 0;}.ast-comment-avatar-wrap img {border-radius: 50%;}.ast-comment-content {clear: both;}.ast-comment-cite-wrap {text-align: left;}.ast-comment-cite-wrap cite {font-style: normal;}.comment-reply-title {padding-top: 1em;font-weight: normal;line-height: 1.65;}.ast-comment-meta {margin-bottom: 0.5em;}.comments-area {border-top: 1px solid #eeeeee;margin-top: 2em;}.comments-area .comment-form-comment {width: 100%;border: none;margin: 0;padding: 0;}.comments-area .comment-notes,.comments-area .comment-textarea,.comments-area .form-allowed-tags {margin-bottom: 1.5em;}.comments-area .form-submit {margin-bottom: 0;}.comments-area textarea#comment,.comments-area .ast-comment-formwrap input[type="text"] {width: 100%;border-radius: 0;vertical-align: middle;margin-bottom: 10px;}.comments-area .no-comments {margin-top: 0.5em;margin-bottom: 0.5em;}.comments-area p.logged-in-as {margin-bottom: 1em;}.ast-separate-container .comments-count-wrapper {background-color: #fff;padding: 2em 6.67em 0;}@media (max-width: 1200px) {.ast-separate-container .comments-count-wrapper {padding: 2em 3.34em;}}.ast-separate-container .comments-area {border-top: 0;}.ast-separate-container .ast-comment-list {padding-bottom: 0;}.ast-separate-container .ast-comment-list li {background-color: #fff;}.ast-separate-container .ast-comment-list li.depth-1 {padding: 4em 6.67em;margin-bottom: 2em;}@media (max-width: 1200px) {.ast-separate-container .ast-comment-list li.depth-1 {padding: 3em 3.34em;}}.ast-separate-container .ast-comment-list li.depth-1 .children li {padding-bottom: 0;padding-top: 0;margin-bottom: 0;}.ast-separate-container .ast-comment-list li.depth-1 .ast-comment,.ast-separate-container .ast-comment-list li.depth-2 .ast-comment {border-bottom: 0;}.ast-separate-container .ast-comment-list .comment-respond {padding-top: 0;padding-bottom: 1em;background-color: transparent;}.ast-separate-container .ast-comment-list .pingback p {margin-bottom: 0;}.ast-separate-container .ast-comment-list .bypostauthor {padding: 2em;margin-bottom: 1em;}.ast-separate-container .ast-comment-list .bypostauthor li {background: transparent;margin-bottom: 0;padding: 0 0 0 2em;}.ast-separate-container .comment-respond {background-color: #fff;padding: 4em 6.67em;border-bottom: 0;}@media (max-width: 1200px) {.ast-separate-container .comment-respond {padding: 3em 2.34em;}}.ast-separate-container .comment-reply-title {padding-top: 0;}.ast-comment-list .children {margin-left: 2em;}@media (max-width: 992px) {.ast-comment-list .children {margin-left: 1em;}}.ast-comment-list #cancel-comment-reply-link {white-space: nowrap;font-size: 15px;font-size: 1rem;margin-left: 1em;}.ast-comment-avatar-wrap {float: left;clear: right;margin-right: 1.33333em;}.ast-comment-meta-wrap {float: left;clear: right;padding: 0 0 1.33333em;}.ast-comment-time .timendate,.ast-comment-time .reply {margin-right: 0.5em;}.comments-area #wp-comment-cookies-consent {margin-right: 10px;}.ast-page-builder-template .comments-area {padding-left: 20px;padding-right: 20px;margin-top: 2em;margin-bottom: 2em;}.ast-separate-container .ast-comment-list .bypostauthor .bypostauthor {background: transparent;margin-bottom: 0;padding-right: 0;padding-bottom: 0;padding-top: 0;}@media (min-width:922px){.ast-separate-container .ast-comment-list li .comment-respond{padding-left:2.66666em;padding-right:2.66666em;}}@media (max-width:544px){.ast-separate-container .comments-count-wrapper{padding:1.5em 1em;}.ast-separate-container .ast-comment-list li.depth-1{padding:1.5em 1em;margin-bottom:1.5em;}.ast-separate-container .ast-comment-list .bypostauthor{padding:.5em;}.ast-separate-container .comment-respond{padding:1.5em 1em;}}@media (max-width:921px){.ast-comment-avatar-wrap img{max-width:2.5em;}.comments-area{margin-top:1.5em;}.ast-separate-container .comments-count-wrapper{padding:2em 2.14em;}.ast-separate-container .ast-comment-list li.depth-1{padding:1.5em 2.14em;}.ast-separate-container .comment-respond{padding:2em 2.14em;}}@media (max-width:921px){.ast-comment-avatar-wrap{margin-right:0.5em;}}
</style>
<link rel='stylesheet' id='astra-google-fonts-css'  href='http://fonts.googleapis.com/css?family=Montserrat%3A400%2C%2C700&amp;display=fallback&amp;ver=3.4.8' media='all' />
<link rel='stylesheet' id='astra-menu-animation-css'  href='../../wp-content/themes/astra/assets/css/minified/menu-animation.minb045.css?ver=3.4.8' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='../../wp-includes/css/dist/block-library/style.mind988.css?ver=5.7.8' media='all' />
<link rel='stylesheet' id='hfe-style-css'  href='../../wp-content/plugins/header-footer-elementor/assets/css/header-footer-elementor2745.css?ver=1.6.4' media='all' />
<link rel='stylesheet' id='elementor-icons-css'  href='../../wp-content/plugins/elementor/assets/lib/eicons/css/elementor-icons.minb683.css?ver=5.12.0' media='all' />
<link rel='stylesheet' id='elementor-frontend-legacy-css'  href='../../wp-content/plugins/elementor/assets/css/frontend-legacy.mincd45.css?ver=3.4.3' media='all' />
<link rel='stylesheet' id='elementor-frontend-css'  href='../../wp-content/plugins/elementor/assets/css/frontend.mincd45.css?ver=3.4.3' media='all' />
<style id='elementor-frontend-inline-css'>
@font-face{font-family:eicons;src:url(../../wp-content/plugins/elementor/assets/lib/eicons/fonts/eicons0b93.eot?5.10.0);src:url(https://vinayaroratech.com/wp-content/plugins/elementor/assets/lib/eicons/fonts/eicons.eot?5.10.0#iefix) format("embedded-opentype"),url(https://vinayaroratech.com/wp-content/plugins/elementor/assets/lib/eicons/fonts/eicons.woff2?5.10.0) format("woff2"),url(https://vinayaroratech.com/wp-content/plugins/elementor/assets/lib/eicons/fonts/eicons.woff?5.10.0) format("woff"),url(https://vinayaroratech.com/wp-content/plugins/elementor/assets/lib/eicons/fonts/eicons.ttf?5.10.0) format("truetype"),url(https://vinayaroratech.com/wp-content/plugins/elementor/assets/lib/eicons/fonts/eicons.svg?5.10.0#eicon) format("svg");font-weight:400;font-style:normal}
</style>
<link rel='stylesheet' id='elementor-post-475-css'  href='../../wp-content/uploads/elementor/css/post-4756c20.css?ver=1630773606' media='all' />
<link rel='stylesheet' id='font-awesome-5-all-css'  href='../../wp-content/plugins/elementor/assets/lib/font-awesome/css/all.mincd45.css?ver=3.4.3' media='all' />
<link rel='stylesheet' id='font-awesome-4-shim-css'  href='../../wp-content/plugins/elementor/assets/lib/font-awesome/css/v4-shims.mincd45.css?ver=3.4.3' media='all' />
<link rel='stylesheet' id='google-fonts-1-css'  href='https://fonts.googleapis.com/css?family=Roboto%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2C400italic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic%7CRoboto+Slab%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2C400%2C400italic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic&amp;display=auto&amp;ver=5.7.8' media='all' />
<!--[if IE]>
<script src='https://vinayaroratech.com/wp-content/themes/astra/assets/js/minified/flexibility.min.js?ver=3.4.8' id='astra-flexibility-js'></script>
<script id='astra-flexibility-js-after'>
flexibility(document.documentElement);
</script>
<![endif]-->
<script src='../../wp-content/plugins/elementor/assets/lib/font-awesome/js/v4-shims.mincd45.js?ver=3.4.3' id='font-awesome-4-shim-js'></script>
<script src='https://www.googletagmanager.com/gtag/js?id=UA-158559775-1' id='google_gtagjs-js' async></script>
<script id='google_gtagjs-js-after'>
window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["vinayaroratech.com"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-158559775-1", {"anonymize_ip":true});
</script>
<link rel="https://api.w.org/" href="../../wp-json/index.html" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/950.json" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7.8" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='../../index974f.html?p=950' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed185f.json?url=https%3A%2F%2Fvinayaroratech.com%2Fdotnet%2Fgetting-started-with-opentelemetry-metrics-in-net-part-2-instrumenting-the-bookstore-api%2F" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embedd23b?url=https%3A%2F%2Fvinayaroratech.com%2Fdotnet%2Fgetting-started-with-opentelemetry-metrics-in-net-part-2-instrumenting-the-bookstore-api%2F&amp;format=xml" />
<meta name="generator" content="Site Kit by Google 1.40.0" /><link rel="pingback" href="../../xmlrpc.php">
<style>.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style><link rel="icon" href="../../wp-content/uploads/2020/05/cropped-android-chrome-512x5121-1-3-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2020/05/cropped-android-chrome-512x5121-1-3-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2020/05/cropped-android-chrome-512x5121-1-3-180x180.png" />
<meta name="msapplication-TileImage" content="https://vinayaroratech.com/wp-content/uploads/2020/05/cropped-android-chrome-512x5121-1-3-270x270.png" />
</head>

<body data-rsssl=1 itemtype='https://schema.org/Blog' itemscope='itemscope' class="post-template-default single single-post postid-950 single-format-standard ehf-template-astra ehf-stylesheet-astra ast-blog-single-style-1 ast-single-post ast-mobile-inherit-site-logo ast-replace-site-logo-transparent ast-inherit-site-logo-transparent ast-hfb-header ast-desktop ast-separate-container ast-two-container ast-no-sidebar astra-3.4.8 ast-full-width-primary-header ast-normal-title-enabled elementor-default elementor-kit-475">
<div 
class="hfeed site" id="page">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
			<header
		class="site-header ast-primary-submenu-animation-fade header-main-layout-1 ast-primary-menu-enabled ast-hide-custom-menu-mobile ast-builder-menu-toggle-icon ast-mobile-header-inline" id="masthead" itemtype="https://schema.org/WPHeader" itemscope="itemscope" itemid="#masthead"		>
			<div id="ast-desktop-header" data-toggle-type="dropdown">
		<div class="ast-main-header-wrap main-header-bar-wrap ">
		<div class="ast-primary-header-bar ast-primary-header main-header-bar site-header-focus-item" data-section="section-primary-header-builder">
						<div class="site-primary-header-wrap ast-builder-grid-row-container site-header-focus-item ast-container" data-section="section-primary-header-builder">
				<div class="ast-builder-grid-row ast-builder-grid-row-has-sides ast-builder-grid-row-no-center">
											<div class="site-header-primary-section-left site-header-section ast-flex site-header-section-left">
									<div class="ast-builder-layout-element ast-flex site-header-focus-item" data-section="title_tagline">
											<div
				class="site-branding ast-site-identity" itemtype="https://schema.org/Organization" itemscope="itemscope"				>
									</div>
			<!-- .site-branding -->
					</div>
								</div>
																									<div class="site-header-primary-section-right site-header-section ast-flex ast-grid-right-section">
										<div class="ast-builder-menu-1 ast-builder-menu ast-flex ast-builder-menu-1-focus-item ast-builder-layout-element site-header-focus-item" data-section="section-hb-menu-1">
			<div class="ast-main-header-bar-alignment"><div class="main-header-bar-navigation"><nav class="ast-flex-grow-1 navigation-accessibility site-header-focus-item" id="site-navigation" aria-label="Site Navigation" itemtype="https://schema.org/SiteNavigationElement" itemscope="itemscope"><div class="main-navigation ast-inline-flex"><ul id="ast-hf-menu-1" class="main-header-menu ast-nav-menu ast-flex  submenu-with-border astra-menu-animation-fade  stack-on-mobile"><li id="menu-item-15" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-15"><a href="../../index.html" class="menu-link">Home</a></li>
<li id="menu-item-14" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14"><a href="../../about/index.html" class="menu-link">About</a></li>
<li id="menu-item-731" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-731"><a href="../../recent-projects/index.html" class="menu-link">Projects</a></li>
<li id="menu-item-811" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-811"><a href="../../blog/index.html" class="menu-link">Blog</a></li>
</ul></div></nav></div></div>		</div>
				<div class="ast-builder-layout-element ast-flex site-header-focus-item ast-header-button-1" data-section="section-hb-button-1">
			<div class="ast-builder-button-wrap ast-builder-button-size-"><a class="ast-custom-button-link" href="../../contact/index.html" target="_self" ><div class=ast-custom-button>Contact</div></a><a class="menu-link" href="../../contact/index.html" target="_self" >Contact</a></div>		</div>
									</div>
												</div>
					</div>
								</div>
			</div>
		<div class="ast-desktop-header-content content-align-flex-start ">
			</div>
</div> <!-- Main Header Bar Wrap -->
<div id="ast-mobile-header" class="ast-mobile-header-wrap " data-type="dropdown">
		<div class="ast-main-header-wrap main-header-bar-wrap" >
		<div class="ast-primary-header-bar ast-primary-header main-header-bar site-primary-header-wrap site-header-focus-item ast-builder-grid-row-layout-default ast-builder-grid-row-tablet-layout-default ast-builder-grid-row-mobile-layout-default" data-section="section-primary-header-builder">
									<div class="ast-builder-grid-row ast-builder-grid-row-has-sides ast-builder-grid-row-no-center">
													<div class="site-header-primary-section-left site-header-section ast-flex site-header-section-left">
										<div class="ast-builder-layout-element ast-flex site-header-focus-item" data-section="title_tagline">
											<div
				class="site-branding ast-site-identity" itemtype="https://schema.org/Organization" itemscope="itemscope"				>
									</div>
			<!-- .site-branding -->
					</div>
									</div>
																									<div class="site-header-primary-section-right site-header-section ast-flex ast-grid-right-section">
										<div class="ast-builder-layout-element ast-flex site-header-focus-item" data-section="section-header-mobile-trigger">
						<div class="ast-button-wrap">
				<button type="button" class="menu-toggle main-header-menu-toggle ast-mobile-menu-trigger-fill"   aria-expanded="false">
					<span class="screen-reader-text">Main Menu</span>
					<span class="mobile-menu-toggle-icon">
						<span class="ahfb-svg-iconset ast-inline-flex svg-baseline"><svg role='img' class='ast-mobile-svg ast-menu-svg' fill='currentColor' version='1.1' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path d='M3 13h18c0.552 0 1-0.448 1-1s-0.448-1-1-1h-18c-0.552 0-1 0.448-1 1s0.448 1 1 1zM3 7h18c0.552 0 1-0.448 1-1s-0.448-1-1-1h-18c-0.552 0-1 0.448-1 1s0.448 1 1 1zM3 19h18c0.552 0 1-0.448 1-1s-0.448-1-1-1h-18c-0.552 0-1 0.448-1 1s0.448 1 1 1z'></path></svg></span><span class="ahfb-svg-iconset ast-inline-flex svg-baseline"><svg class='ast-mobile-svg ast-close-svg' fill='currentColor' version='1.1' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path d='M5.293 6.707l5.293 5.293-5.293 5.293c-0.391 0.391-0.391 1.024 0 1.414s1.024 0.391 1.414 0l5.293-5.293 5.293 5.293c0.391 0.391 1.024 0.391 1.414 0s0.391-1.024 0-1.414l-5.293-5.293 5.293-5.293c0.391-0.391 0.391-1.024 0-1.414s-1.024-0.391-1.414 0l-5.293 5.293-5.293-5.293c-0.391-0.391-1.024-0.391-1.414 0s-0.391 1.024 0 1.414z'></path></svg></span>					</span>
									</button>
			</div>
					</div>
									</div>
											</div>
						</div>
	</div>
		<div class="ast-mobile-header-content content-align-flex-start ">
				<div class="ast-builder-menu-1 ast-builder-menu ast-flex ast-builder-menu-1-focus-item ast-builder-layout-element site-header-focus-item" data-section="section-hb-menu-1">
			<div class="ast-main-header-bar-alignment"><div class="main-header-bar-navigation"><nav class="ast-flex-grow-1 navigation-accessibility site-header-focus-item" id="site-navigation" aria-label="Site Navigation" itemtype="https://schema.org/SiteNavigationElement" itemscope="itemscope"><div class="main-navigation ast-inline-flex"><ul id="ast-hf-menu-1" class="main-header-menu ast-nav-menu ast-flex  submenu-with-border astra-menu-animation-fade  stack-on-mobile"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-15"><a href="../../index.html" class="menu-link">Home</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14"><a href="../../about/index.html" class="menu-link">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-731"><a href="../../recent-projects/index.html" class="menu-link">Projects</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-811"><a href="../../blog/index.html" class="menu-link">Blog</a></li>
</ul></div></nav></div></div>		</div>
			</div>
</div>
		</header><!-- #masthead -->
			<div id="content" class="site-content">
		<div class="ast-container">
		

	<div id="primary" class="content-area primary">

		
					<main id="main" class="site-main">
				

<article
class="post-950 post type-post status-publish format-standard hentry category-dotnet tag-net6 tag-csharp tag-dotnet tag-grafana tag-metrics tag-opentelemetry tag-prometheus ast-article-single" id="post-950" itemtype="https://schema.org/CreativeWork" itemscope="itemscope">

	
	
<div class="ast-post-format- ast-no-thumb single-layout-1">

	
	<header class="entry-header ast-no-thumbnail">

		
				<div class="ast-single-post-order">
			<h1 class="entry-title" itemprop="headline">Getting started with OpenTelemetry Metrics in .NET. Part 2: Instrumenting the BookStore API</h1><div class="entry-meta"><span class="cat-links"><a href="../../category/dotnet/index.html" rel="category tag">.NET</a></span> / <span class="posted-on"><span class="published" itemprop="datePublished"> January 10, 2023</span><span class="updated" itemprop="dateModified"> January 10, 2023</span></span> / 			<span class="comments-link">
				<a href="index.html#respond">Leave a Comment</a>			</span>

			</div>		</div>
		
		
	</header><!-- .entry-header -->

	
	<div class="entry-content clear" 
	itemprop="text"	>

		
		
<p>This is a 2 part-series post.</p>



<ul><li><strong>Part 1</strong>: Key concepts that you should know when using OpenTelemetry Metrics with .NET. If you want to read it, click&nbsp;<a href="https://www.mytechramblings.com/posts/getting-started-with-opentelemetry-metrics-and-dotnet-part-1/">here</a>.</li><li><strong>Part 2</strong>: A practical example about how to add OpenTelemetry Metrics on a real life .NET app and how to visualize those metrics using Prometheus and Grafana.</li></ul>



<p><strong>Just show me the code!</strong><br>As always, if you don’t care about the post I have uploaded the source code on my&nbsp;<a href="https://github.com/vinaykarora/opentelemetry-tracing-demo">Github</a>.</p>



<p>In part 1 we talked about some OpenTelemetry Metrics key concepts, now it’s time to focus on instrumenting a real application.</p>



<p>This is what we are going to build.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-app-diagram.png" alt="otel-metrics-app-diagram"/></figure>



<ul><li>The&nbsp;<strong>BookStore WebAPI</strong>&nbsp;will generate some business metrics and use the OTLP exporter package (<code>OpenTelemetry.Exporter.OpenTelemetryProtocol</code>) to send the metric data to the&nbsp;<strong>OpenTelemetry Collector</strong>.</li><li><strong>Prometheus</strong>&nbsp;will obtain the metric data from the OpenTelemetry Collector.</li><li>We will have a&nbsp;<strong>Grafana</strong>&nbsp;dashboard to visualize the metrics emitted by the BookStore WebApi.</li></ul>



<h1 id="application"><strong>Application</strong></h1>



<p>The application we’re going to instrument using OpenTelemetry Metrics is a BookStore API built using .NET6.<br>The API can do the following actions:</p>



<ul><li>Get, add, update and delete book categories.</li><li>Get, add, update and delete books.</li><li>Get, add, update and delete inventory.</li><li>Get, add and update orders.</li></ul>



<p>For a better understanding, here’s how the database diagram looks like:</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-bookstore-database-diagram.png" alt="otel-metrics-bookstore-database-diagram"/></figure>



<h1 id="opentelemetry-metrics"><strong>OpenTelemetry Metrics</strong></h1>



<p>The first step before writing any code is to decide what we want to measure and what kind of instruments are we going to use.</p>



<h2 id="bookstore-api-custom-metrics">BookStore API custom metrics</h2>



<p>The following business metrics will be instrumented directly on the application using the Metrics API.</p>



<ul><li><code>BooksAddedCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts books added to the store.</li><li><code>BooksDeletedCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts books deleted from the store.</li><li><code>BooksUpdatedCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts books updated.</li><li><code>TotalBooksGauge</code>&nbsp;is an&nbsp;<code>ObservableGauge</code>&nbsp;that contains the total number of books that the store has at any given time.</li><li><code>CategoriesAddedCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts book categories added to the store.</li><li><code>CategoriesDeletedCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts book categories deleted from the store.</li><li><code>CategoriesUpdatedCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts book categories updated.</li><li><code>TotalCategoriesGauge</code>&nbsp;is an&nbsp;<code>ObservableGauge</code>&nbsp;that contains the total number of book categories that the store has at any given time</li><li><code>OrdersPriceHistogram</code>&nbsp;is a&nbsp;<code>Histogram</code>&nbsp;that records the price distribution of the orders.</li><li><code>NumberOfBooksPerOrderHistogram</code>&nbsp;is a&nbsp;<code>Histogram</code>&nbsp;that records the number of books distribution per order.</li><li><code>OrdersCanceledCounter</code>&nbsp;is an&nbsp;<code>ObservableCounter</code>&nbsp;that counts the total number of orders cancelled.</li><li><code>TotalOrdersCounter</code>&nbsp;is a&nbsp;<code>Counter</code>&nbsp;that counts the total number of orders that the store has received.</li></ul>



<h2 id="http-requests-metrics">Http requests metrics</h2>



<p>Those metrics are generated by the&nbsp;<code>OpenTelemetry.Instrumentation.AspNetCore</code>&nbsp;NuGet package.<br>This is an instrumentation library, which instruments .NET and creates metrics about incoming web requests.</p>



<p>There is no need to instrument anything on the application. To start using the&nbsp;<code>OpenTelemetry.Instrumentation.AspNetCore</code>&nbsp;package you only need to add the&nbsp;<code>AddAspNetCoreInstrumentation()</code>&nbsp;extension method when setting up the .NET OpenTelemetry&nbsp;<code>MeterProvider</code>&nbsp;component. Here’s an example:</p>



<pre class="wp-block-code"><code>using Microsoft.Extensions.DependencyInjection;
using OpenTelemetry.Trace;

public void ConfigureServices(IServiceCollection services)
{
    services.AddOpenTelemetryTracing((builder) =&gt; builder
        .AddAspNetCoreInstrumentation()
    );
}
</code></pre>



<h2 id="systemruntime-performance-metrics">System.Runtime performance metrics</h2>



<p>Those metrics are generated by the&nbsp;<code>OpenTelemetry.Instrumentation.Runtime</code>&nbsp;NuGet package. This is an instrumentation library, which instruments .NET Runtime and collects runtime performance metrics.</p>



<p>There is no need to instrument anything on the application. To start using the&nbsp;<code>OpenTelemetry.Instrumentation.Runtime</code>&nbsp;package you only need to add the&nbsp;<code>AddRuntimeInstrumentation()</code>&nbsp;extension method when setting up the .NET OpenTelemetry&nbsp;<code>MeterProvider</code>&nbsp;component. Here’s an example:</p>



<pre class="wp-block-code"><code>using Microsoft.Extensions.DependencyInjection;
using OpenTelemetry.Trace;

public void ConfigureServices(IServiceCollection services)
{
    services.AddOpenTelemetryTracing((builder) =&gt; builder
        .AddRuntimeInstrumentation()
    );
}
</code></pre>



<p>The&nbsp;<code>OpenTelemetry.Instrumentation.Runtime</code>&nbsp;package collects telemetry about the following&nbsp;<code>System.Runtime</code>&nbsp;counters:</p>



<ul><li><code>process.runtime.dotnet.gc.collections.count</code>: Number of garbage collections that have occurred since process start.</li><li><code>process.runtime.dotnet.gc.allocations.size</code>: Count of bytes allocated on the managed GC heap since the process start</li><li><code>process.runtime.dotnet.gc.committed_memory.size</code>: The amount of committed virtual memory for the managed GC heap, as observed during the latest garbage collection.</li><li><code>process.runtime.dotnet.gc.heap.size</code>: The heap size (including fragmentation), as observed during the latest garbage collection.</li><li><code>process.runtime.dotnet.gc.heap.fragmentation.size</code>: The heap fragmentation, as observed during the latest garbage collection.</li><li><code>process.runtime.dotnet.jit.il_compiled.size</code>: Count of bytes of intermediate language that have been compiled since the process start.</li><li><code>process.runtime.dotnet.jit.methods_compiled.count</code>: The number of times the JIT compiler compiled a method since the process start.</li><li><code>process.runtime.dotnet.jit.compilation_time</code>: The amount of time the JIT compiler has spent compiling methods since the process start.</li><li><code>process.runtime.dotnet.monitor.lock_contention.count</code>: The number of times there was contention when trying to acquire a monitor lock since the process start.</li><li><code>process.runtime.dotnet.thread_pool.threads.count</code>: The number of thread pool threads that currently exist.</li><li><code>process.runtime.dotnet.thread_pool.completed_items.count</code>: The number of work items that have been processed by the thread pool since the process start.</li><li><code>process.runtime.dotnet.thread_pool.queue.length</code>: The number of work items that are currently queued to be processed by the thread pool.</li><li><code>process.runtime.dotnet.timer.count</code>: The number of timer instances that are currently active.</li><li><code>process.runtime.dotnet.assemblies.count</code>: The number of .NET assemblies that are currently loaded.</li><li><code>process.runtime.dotnet.exceptions.count</code>: Count of exceptions that have been thrown in managed code, since the observation started.</li></ul>



<p>Some of the GC related metrics will be unavailable until at least one garbage collection has occurred.</p>



<h1 id="opentelemetry-net-client"><strong>OpenTelemetry .NET Client</strong></h1>



<p>To get started with OpenTelemetry Metrics we’re going to need the following packages.</p>



<pre class="wp-block-code"><code>&lt;PackageReference Include="OpenTelemetry.Extensions.Hosting" Version="1.0.0-rc9.6" /&gt;
&lt;PackageReference Include="OpenTelemetry.Instrumentation.AspNetCore" Version="1.0.0-rc9.6" /&gt;
&lt;PackageReference Include="OpenTelemetry.Instrumentation.Runtime" Version="1.0.0" /&gt;
&lt;PackageReference Include="OpenTelemetry.Exporter.OpenTelemetryProtocol" Version="1.3.1" /&gt;
</code></pre>



<ul><li>The&nbsp;<strong>OpenTelemetry.Extensions.Hosting</strong>&nbsp;package contains some extensions that allows us to configure the&nbsp;<strong>MeterProvider</strong>.</li><li>The&nbsp;<strong>OpenTelemetry.Instrumentation.</strong>* packages are instrumentation libraries. These packages are instrumenting common libraries/functionalities/classes so we don’t have to do all the heavy lifting by ourselves. In our application we’re using the following ones:<ul><li>The&nbsp;<strong>OpenTelemetry.Instrumentation.AspNetCore</strong>&nbsp;package generats and collects metrics about incoming web requests.</li><li>The&nbsp;<strong>OpenTelemetry.Instrumentation.Runtime</strong>&nbsp;package collects runtime performance metrics.</li></ul></li><li>The&nbsp;<strong>OpenTelemetry.Exporter.OpenTelemetryProtocol</strong>&nbsp;package allows us to export the metrics to the OpenTelemetry Collector using the OTLP protocol.</li></ul>



<h1 id="add-opentelemetry-metrics-on-the-bookstore-app"><strong>Add OpenTelemetry Metrics on the BookStore app</strong></h1>



<h2 id="1---setup-the-meterprovider"><strong>1 &#8211; Setup the MeterProvider</strong></h2>



<pre class="wp-block-code"><code>var meters = new OtelMetrics();

builder.Services.AddOpenTelemetryMetrics(opts =&gt; opts
    .SetResourceBuilder(ResourceBuilder.CreateDefault().AddService("BookStore.WebApi"))
    .AddMeter(meters.MetricName)
    .AddAspNetCoreInstrumentation()
    .AddRuntimeInstrumentation()
    .AddOtlpExporter(opts =&gt;
    {
        opts.Endpoint = new Uri(builder.Configuration&#91;"Otlp:Endpoint"]);
    }));
</code></pre>



<p>Let’s review what we’re doing line by line.</p>



<pre class="wp-block-code"><code>AddOpenTelemetryMetrics()
</code></pre>



<p>OpenTelemetry Metrics works by using the&nbsp;<code>MeterProvider</code>&nbsp;to create a&nbsp;<code>Meter</code>&nbsp;and associating it with one or more&nbsp;<code>Instruments</code>, each of which is used to create a series of&nbsp;<code>Measurements</code>.</p>



<p>The&nbsp;<code>MeterProvider</code>&nbsp;holds the configuration for metrics like Meter names, Readers or Views.</p>



<p>The&nbsp;<code>MeterProvider</code>&nbsp;must be configured using the&nbsp;<code>AddOpenTelemetryMetrics()</code>&nbsp;extension method.</p>



<pre class="wp-block-code"><code>SetResourceBuilder(ResourceBuilder.CreateDefault().AddService("BookStore.WebApi"))
</code></pre>



<p>A&nbsp;<code>Resource</code>&nbsp;is the immutable representation of the entity producing the telemetry. With the&nbsp;<code>SetResourceBuilder</code>&nbsp;method we’re configuring the&nbsp;<code>Resource</code>&nbsp;for the application.</p>



<p>The&nbsp;<code>SetResourceBuilder</code>&nbsp;gives us the possibility to configure attributes like the service name or the application name amongst others.</p>



<p>Using the&nbsp;<code>AddService("BookStore.Webapi")</code>&nbsp;method we can set the service name as an attribute of the metric data. For example, if we take a look at the&nbsp;<code>OrdersCanceledCounter</code>&nbsp;instrument on Prometheus, we will see the following information:</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-prometheus-resource-builder.png" alt="otel-metrics-prometheus-resource-builder"/></figure>



<pre class="wp-block-code"><code>AddMeter(meters.MetricName)
</code></pre>



<p>Any&nbsp;<code>Instrument</code>&nbsp;that we create in our application needs to be associated with a&nbsp;<code>Meter</code>. The&nbsp;<code>AddMeter()</code>&nbsp;extension method configures OpenTelemetry to transmit all the metrics collected by this concrete&nbsp;<code>Meter</code>.</p>



<p>As you’ll see later, in the BookStore app I have a single&nbsp;<code>Meter</code>&nbsp;with multiple&nbsp;<code>Instruments</code>&nbsp;on it, but you can also have multiple&nbsp;<code>Meters</code>&nbsp;in a single application, in that case you’ll need to add multiple calls to the&nbsp;<code>AddMeter()</code>&nbsp;method.</p>



<pre class="wp-block-code"><code>AddAspNetCoreInstrumentation()
</code></pre>



<p>This method comes from the&nbsp;<code>OpenTelemetry.Instrumentation.AspNetCore</code>&nbsp;NuGet package, it instruments .NET and collects metrics and traces about incoming web requests.</p>



<pre class="wp-block-code"><code>AddRuntimeInstrumentation()
</code></pre>



<p>This method comes from the&nbsp;<code>OpenTelemetry.Instrumentation.Runtime</code>&nbsp;NuGet package, it instruments .NET and collects metrics and collects runtime performance metrics.</p>



<pre class="wp-block-code"><code>AddOtlpExporter(opts =&gt;
{
    opts.Endpoint = new Uri(builder.Configuration&#91;"Otlp:Endpoint"]);
}));
</code></pre>



<p>The&nbsp;<code>AddOtlpExporter</code>&nbsp;method is used to configure the exporter that sends all the metric data to the OpenTelemetry Collector.</p>



<h2 id="2---create-the-meter-and-instruments"><strong>2 &#8211; Create the Meter and Instruments</strong></h2>



<p>After setting up the&nbsp;<code>MeterProvider</code>, it’s time to create a&nbsp;<code>Meter</code>&nbsp;and use it to create&nbsp;<code>Instruments</code>.</p>



<p>There are a few ways to do that, but I’m going to show you how I tend to do it.<br>First of all, I’m going to create a&nbsp;<code>Singleton</code>&nbsp;class which will contain:</p>



<ul><li>A meter.</li><li>The instruments associated with the meter.</li><li>A series of helper methods to record measurements with those instruments.</li></ul>



<p>Here’s how the class looks like:</p>



<pre class="wp-block-code"><code>using System.Collections.Generic;
using System.Diagnostics.Metrics;
using System.Threading;

namespace BookStore.Infrastructure.Metrics
{
    public class OtelMetrics
    {
        //Books meters
        private  Counter&lt;int&gt; BooksAddedCounter { get; }
        private  Counter&lt;int&gt; BooksDeletedCounter { get; }
        private  Counter&lt;int&gt; BooksUpdatedCounter { get; }
        private  ObservableGauge&lt;int&gt; TotalBooksGauge { get; }
        private int _totalBooks = 0;

        //Categories meters
        private Counter&lt;int&gt; CategoriesAddedCounter { get; }
        private Counter&lt;int&gt; CategoriesDeletedCounter { get; }
        private Counter&lt;int&gt; CategoriesUpdatedCounter { get; }
        private ObservableGauge&lt;int&gt; TotalCategoriesGauge { get; }
        private int _totalCategories = 0;

        //Order meters
        private Histogram&lt;double&gt; OrdersPriceHistogram { get; }
        private Histogram&lt;int&gt; NumberOfBooksPerOrderHistogram { get; }
        private ObservableCounter&lt;int&gt; OrdersCanceledCounter { get; }
        private int _ordersCanceled = 0;
        private Counter&lt;int&gt; TotalOrdersCounter { get; }

        public string MetricName { get; }

        public OtelMetrics(string meterName = "BookStore")
        {
            var meter = new Meter(meterName);
            MetricName = meterName;

            BooksAddedCounter = meter.CreateCounter&lt;int&gt;("books-added", "Book");
            BooksDeletedCounter = meter.CreateCounter&lt;int&gt;("books-deleted", "Book");
            BooksUpdatedCounter = meter.CreateCounter&lt;int&gt;("books-updated", "Book");
            TotalBooksGauge = meter.CreateObservableGauge&lt;int&gt;("total-books", () =&gt; new&#91;] { new Measurement&lt;int&gt;(_totalBooks) });
            
            CategoriesAddedCounter = meter.CreateCounter&lt;int&gt;("categories-added", "Category");
            CategoriesDeletedCounter = meter.CreateCounter&lt;int&gt;("categories-deleted", "Category");
            CategoriesUpdatedCounter = meter.CreateCounter&lt;int&gt;("categories-updated", "Category");
            TotalCategoriesGauge = meter.CreateObservableGauge&lt;int&gt;("total-categories", () =&gt; _totalCategories);

            OrdersPriceHistogram = meter.CreateHistogram&lt;double&gt;("orders-price", "Euros", "Price distribution of book orders");
            NumberOfBooksPerOrderHistogram = meter.CreateHistogram&lt;int&gt;("orders-number-of-books", "Books", "Number of books per order");
            OrdersCanceledCounter = meter.CreateObservableCounter&lt;int&gt;("orders-canceled", () =&gt; _ordersCanceled);
            TotalOrdersCounter = meter.CreateCounter&lt;int&gt;("total-orders", "Orders");
        }

        //Books meters
        public void AddBook() =&gt; BooksAddedCounter.Add(1);
        public void DeleteBook() =&gt; BooksDeletedCounter.Add(1);
        public void UpdateBook() =&gt; BooksUpdatedCounter.Add(1);
        public void IncreaseTotalBooks() =&gt; _totalBooks++;
        public void DecreaseTotalBooks() =&gt; _totalBooks--;

        //Categories meters
        public void AddCategory() =&gt; CategoriesAddedCounter.Add(1);
        public void DeleteCategory() =&gt; CategoriesDeletedCounter.Add(1);
        public void UpdateCategory() =&gt; CategoriesUpdatedCounter.Add(1);
        public void IncreaseTotalCategories() =&gt; _totalCategories++;
        public void DecreaseTotalCategories() =&gt; _totalCategories--;

        //Orders meters
        public void RecordOrderTotalPrice(double price) =&gt; OrdersPriceHistogram.Record(price);
        public void RecordNumberOfBooks(int amount) =&gt; NumberOfBooksPerOrderHistogram.Record(amount);
        public void IncreaseOrdersCanceled() =&gt; _ordersCanceled++;
        public void IncreaseTotalOrders(string city) =&gt; TotalOrdersCounter.Add(1, KeyValuePair.Create&lt;string, object&gt;("City", city));

    }
}
</code></pre>



<p>In the class constructor, we create the meter and then use it to create every necessary instrument. Also we create a series of public helper methods to record measurements.</p>



<ul><li><em>Why create all those helper methods?</em></li></ul>



<p>To improve code readability, it is easier to understand what this line of code&nbsp;<code>_meters.AddBook()</code>&nbsp;is doing, rather than this other one&nbsp;<code>BooksAddedCounter.Add(1)</code>.</p>



<h2 id="3---record-measurements-using-the-instruments"><strong>3 &#8211; Record measurements using the instruments</strong></h2>



<p>Now it’s time to use the instruments we have created in the previous section to start recording measurements.</p>



<p>You just need to inject the&nbsp;<code>OtelMetrics</code>&nbsp;instance whenever we want to record a measurement and use any of the helper methods exposed on the&nbsp;<code>OtelMetrics</code>&nbsp;class.</p>



<h3 id="record-book-metrics"><strong>Record book metrics</strong></h3>



<ul><li>Every time a new book gets added into the database.<ul><li>Increase +1 the&nbsp;<code>BooksAddedCounter</code>&nbsp;instrument and increase +1 the&nbsp;<code>TotalBooksGauge</code>&nbsp;instrument.</li></ul></li><li>Every time a new book gets updated.<ul><li>Increase +1 the&nbsp;<code>BooksUpdatedCounter</code>&nbsp;instrument.</li></ul></li><li>Every time a new book gets deleted from the database.<ul><li>Increase +1 the&nbsp;<code>BooksDeletedCounter</code>&nbsp;instrument and decrease -1 the&nbsp;<code>TotalBooksGauge</code>&nbsp;instrument.</li></ul></li></ul>



<p>The next snippet of code shows how to record those measurements every time a book gets added, updated or deleted from the database.</p>



<pre class="wp-block-code"><code>public class BookRepository : Repository&lt;Book&gt;, IBookRepository
{
    private readonly OtelMetrics _meters;

    public BookRepository(
        BookStoreDbContext context, 
        OtelMetrics meters) : base(context)
    {
        _meters = meters;
    }

    public override async Task&lt;List&lt;Book&gt;&gt; GetAll()
    {
        return await Db.Books.Include(b =&gt; b.Category)
            .OrderBy(b =&gt; b.Name)
            .ToListAsync();
    }

    public override async Task&lt;Book&gt; GetById(int id)
    {
        return await Db.Books.Include(b =&gt; b.Category)
            .Where(b =&gt; b.Id == id)
            .FirstOrDefaultAsync();
    }

    public async Task&lt;IEnumerable&lt;Book&gt;&gt; GetBooksByCategory(int categoryId)
    {
        return await Search(b =&gt; b.CategoryId == categoryId);
    }

    public async Task&lt;IEnumerable&lt;Book&gt;&gt; SearchBookWithCategory(string searchedValue)
    {
        return await Db.Books.AsNoTracking()
            .Include(b =&gt; b.Category)
            .Where(b =&gt; b.Name.Contains(searchedValue) || 
                        b.Author.Contains(searchedValue) ||
                        b.Description.Contains(searchedValue) ||
                        b.Category.Name.Contains(searchedValue))
            .ToListAsync();
    }

    public override async Task Add(Book entity)
    {
        await base.Add(entity);

        _meters.AddBook();
        _meters.IncreaseTotalBooks();
    }

    public override async Task Update(Book entity)
    {
        await base.Update(entity);

        _meters.UpdateBook();
    }

    public override async Task Remove(Book entity)
    {
        await base.Remove(entity);

        _meters.DeleteBook();
        _meters.DecreaseTotalBooks();
    }
}
</code></pre>



<h3 id="record-book-categories-metrics"><strong>Record book categories metrics</strong></h3>



<ul><li>Every time a new book category gets added into the database.<ul><li>Increase +1 the&nbsp;<code>CategoriesAddedCounter</code>&nbsp;instrument and increase +1 the&nbsp;<code>TotalCategoriesGauge</code>&nbsp;instrument.</li></ul></li><li>Every time a new book category gets updated.<ul><li>Increase +1 the&nbsp;<code>CategoriesUpdatedCounter</code>&nbsp;instrument.</li></ul></li><li>Every time a new book category gets deleted from the database.<ul><li>Increase +1 the&nbsp;<code>CategoriesDeletedCounter</code>&nbsp;instrument and decrease -1 the&nbsp;<code>TotalCategoriesGauge</code>&nbsp;instrument.</li></ul></li></ul>



<p>The next snippet of code shows how to record those measurements every time a book category gets added, updated or deleted from the database.</p>



<pre class="wp-block-code"><code>public class CategoryRepository : Repository&lt;Category&gt;, ICategoryRepository
{
    private readonly OtelMetrics _meters;

    public CategoryRepository(BookStoreDbContext context, 
        OtelMetrics meters) : base(context)
    {
        _meters = meters;
    }

    public override async Task Add(Category entity)
    {
        await base.Add(entity);
        _meters.AddCategory();
        _meters.IncreaseTotalCategories();
    }

    public override async Task Update(Category entity)
    {
        await base.Update(entity);
        _meters.UpdateCategory();
    }

    public override async Task Remove(Category entity)
    {
        await base.Remove(entity);
        _meters.DeleteCategory();
        _meters.DecreaseTotalCategories();
    }
}
</code></pre>



<h3 id="record-orders-metrics"><strong>Record orders metrics</strong></h3>



<ul><li>Every time a new order gets added into the database.<ul><li>Increase +1 the&nbsp;<code>TotalOrdersCounter</code>&nbsp;instrument.</li><li>Record the order total price using the&nbsp;<code>OrdersPriceHistogram</code>&nbsp;instrument.</li><li>Record the amount of books in the order using the&nbsp;<code>NumberOfBooksPerOrderHistogram</code>&nbsp;instrument.</li></ul></li><li>Every time a new order gets updated.<ul><li>Increase +1 the&nbsp;<code>OrdersCanceledCounter</code>&nbsp;instrument.</li></ul></li></ul>



<p>The next snippet of code shows how to record those measurements every time an order gets added or updated.</p>



<pre class="wp-block-code"><code>public class OrderRepository : Repository&lt;Order&gt;, IOrderRepository
{
    private readonly OtelMetrics _meters;

    public OrderRepository(BookStoreDbContext context, OtelMetrics meters) 
        : base(context)
    {
        _meters = meters;
    }

    public override async Task&lt;Order&gt; GetById(int id)
    {
        return await Db.Orders
            .Include(b =&gt; b.Books)
            .FirstOrDefaultAsync(x =&gt; x.Id == id);
    }

    public override async Task&lt;List&lt;Order&gt;&gt; GetAll()
    {
        return await Db.Orders
            .Include(b =&gt; b.Books)
            .ToListAsync();
    }

    public override async Task Add(Order entity)
    {
        DbSet.Add(entity);
        await base.SaveChanges();

        _meters.RecordOrderTotalPrice(entity.TotalAmount);
        _meters.RecordNumberOfBooks(entity.Books.Count);
        _meters.IncreaseTotalOrders(entity.City);
    }

    public override async Task Update(Order entity)
    {
        await base.Update(entity);

        _meters.IncreaseOrdersCanceled();
    }

    public async Task&lt;List&lt;Order&gt;&gt; GetOrdersByBookId(int bookId)
    {
        return await Db.Orders.AsNoTracking()
            .Include(b =&gt; b.Books)
            .Where(x =&gt; x.Books.Any(y =&gt; y.Id == bookId))
            .ToListAsync();

    }
}
</code></pre>



<p>As you can see from the snippets of code from this section recording a measurement it’s a really simple task, just invoke the instrument function wherever you want to record a measurement, and that’s it!</p>



<h2 id="4---setup-the-histogram-bucket-aggregation-accordingly"><strong>4 &#8211; Setup the Histogram bucket aggregation accordingly</strong></h2>



<p>A&nbsp;<code>Histogram</code>&nbsp;is a graphical representation of the distribution of numerical data. It groups values into buckets and then counts how many values fall into each bucket.</p>



<p>When using a&nbsp;<code>Histogram</code>&nbsp;instrument, it’s important to make sure the buckets are also configured properly. The bucket histogram aggregation default values are [ 0, 5, 10, 25, 50, 75, 100, 250, 500, 1000 ], and that’s not always ideal.</p>



<p>In the BookStore app we are using 2&nbsp;<code>Histograms</code>:</p>



<ul><li><code>OrdersPriceHistogram</code>: Shows the price distribution of the orders.</li><li><code>NumberOfBooksPerOrderHistogram</code>: Shows the number of books per order distribution.</li></ul>



<p>For the&nbsp;<code>NumberOfBooksPerOrderHistogram</code>&nbsp;makes no sense using the bucket aggregation default values because no one is going to make an order that contains 250, 500 or 1000 books. And the same could be said for the&nbsp;<code>OrdersPriceHistogram</code>.</p>



<p>To customize the bucket aggregation values accordingly to every&nbsp;<code>Histogram</code>&nbsp;we need to use a&nbsp;<code>View</code>.<br>A&nbsp;<code>View</code>&nbsp;in OpenTelemetry defines an aggregation, which takes a series of measurements and expresses them as a single metric value at that point in time.</p>



<p>To create a&nbsp;<code>View</code>&nbsp;we can use the&nbsp;<code>AddView</code>&nbsp;extension method from the&nbsp;<code>MeterProvider</code>. Like this:</p>



<pre class="wp-block-code"><code>builder.Services.AddOpenTelemetryMetrics(opts =&gt; opts
    .SetResourceBuilder(ResourceBuilder.CreateDefault().AddService("BookStore.WebApi"))
    .AddMeter(meters.MetricName)
    .AddAspNetCoreInstrumentation()
    .AddRuntimeInstrumentation()
    .AddView(
        instrumentName: "orders-price",
        new ExplicitBucketHistogramConfiguration { Boundaries = new double&#91;] { 15, 30, 45, 60, 75 } })
    .AddView(
        instrumentName: "orders-number-of-books",
        new ExplicitBucketHistogramConfiguration { Boundaries = new double&#91;] { 1, 2, 5 } })
    .AddOtlpExporter(opts =&gt;
    {
        opts.Endpoint = new Uri(builder.Configuration&#91;"Otlp:Endpoint"]);
    }));
</code></pre>



<h1 id="opentelemetry-collector"><strong>OpenTelemetry Collector</strong></h1>



<p>The OpenTelemetry Collector consists of three components:</p>



<ul><li><code>Receivers</code>: Can be push or pull based, is how data gets into the Collector.</li><li><code>Processors</code>: Run on data between being received and being exported.</li><li><code>Exporters</code>: Can be push or pull based, is how you send data to one or more backends/destinations.</li></ul>



<p>In this case, the OpenTelemetry Collector receives metrics from the BookStore API via gRPC and exports them into Prometheus.<br>Here’s how the OTEL Collector config file looks like:</p>



<pre class="wp-block-code"><code>receivers:
  otlp:
    protocols:
      grpc:

exporters:
  prometheus:
    endpoint: "0.0.0.0:8889"

processors:
  batch:

extensions:
  health_check:

service:
  extensions: &#91;health_check]
  pipelines:
    metrics:
      receivers: &#91;otlp]
      processors: &#91;batch]
      exporters: &#91;prometheus]
</code></pre>



<h1 id="prometheus"><strong>Prometheus</strong></h1>



<p>Prometheus must be configured to scrape the OpenTelemetry Collector metrics endpoints.</p>



<pre class="wp-block-code"><code>global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'otel-collector'
    scrape_interval: 5s
    static_configs:
      - targets: &#91;'otel-collector:8889']
      - targets: &#91;'otel-collector:8888']
</code></pre>



<p>After setting up Prometheus, we are going to generate traffic on the BookStore API and afterwards access Prometheus to start analyzing the metrics that the app is sending us.</p>



<p>The business metrics from the BookStore API are all available in Prometheus.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-prometheus-metrics-explorer.png" alt="otel-metrics-prometheus-metrics-explorer"/></figure>



<p>If we take a peek at the “orders-price”&nbsp;<code>Histogram</code>&nbsp;we can see that the bucket aggregation values are the correct ones that we defined in the&nbsp;<code>MeterProvider</code>&nbsp;using the&nbsp;<code>AddView</code>&nbsp;extension method.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-prometheus-orders-price-histogram.png" alt="otel-metrics-prometheus-orders-price-histogram.png"/></figure>



<p>The metrics about incoming requests generated by the&nbsp;<code>OpenTelemetry.Instrumentation.AspNetCore</code>&nbsp;NuGet package are also available on Prometheus.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-prometheus-incoming-requests-metrics.png" alt="otel-metrics-prometheus-incoming-requests-metrics.png"/></figure>



<p>And the performance metrics generated by the&nbsp;<code>OpenTelemetry.Instrumentation.Runtime</code>&nbsp;NuGet package are also being ingested by Prometheus.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-prometheus-perf-counter-metrics.png" alt="otel-metrics-prometheus-perf-counter-metrics"/></figure>



<h1 id="grafana"><strong>Grafana</strong></h1>



<p>Having the metric data from the BookStore API in Prometheus is great at all, but we need to visualize them in a friendly manner, so let’s build a few Grafana dashboards.</p>



<blockquote class="wp-block-quote"><p><em>Not going to explain how to build a Grafana dashboard, that’s out of the scope for this post.</em></p></blockquote>



<p>I ended up building 3 dashboards.</p>



<h2 id="custom-metrics-dashboard"><strong>Custom metrics dashboard</strong></h2>



<p>This dashboard uses the business metrics instrumented directly on the application using the Metrics API.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-bookstore-custom-metrics.png" alt="otel-metrics-bookstore-custom-metrics"/></figure>



<p>Here’s a closer look of how the “Orders” panel from the dashboard look like:</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-bookstore-custom-orders-metrics.png" alt="otel-metrics-bookstore-custom-orders-metrics"/></figure>



<h2 id="http-requests-dashboard"><strong>Http Requests dashboard</strong></h2>



<p>This dashboard uses the metrics generated by the&nbsp;<code>OpenTelemetry.Instrumentation.AspNetCore</code>&nbsp;NuGet package.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-http-requests-dashboard.png" alt="otel-metrics-http-requests-dashboard"/></figure>



<h2 id="performance-counters-dashboard"><strong>Performance counters dashboard</strong></h2>



<p>This dashboard uses the metrics generated by the&nbsp;<code>OpenTelemetry.Instrumentation.Runtime</code>&nbsp;NuGet package.</p>



<figure class="wp-block-image"><img src="../../../www.mytechramblings.com/img/otel-metrics-perf-counters-dashboard.png" alt="otel-metrics-perf-counters-dashboard.png"/></figure>



<h1 id="how-to-test-the-bookstore-api"><strong>How to test the BookStore Api</strong></h1>



<p>If you want to take a look at the source code, you can go to my&nbsp;<a href="https://github.com/vinaykarora/opentelemetry-tracing-demo">GitHub repository</a>.</p>



<p>If you want to execute the BookStore API for yourselves, I have uploaded a&nbsp;<code>docker-compose</code>&nbsp;file that starts up the app and also the external dependencies.<br>The external dependencies (Prometheus, MSSQL Server, Grafana and OpenTelemetry Collector) are already preconfigured so you don’t need to do any extra setup. Just run&nbsp;<code>docker-compose</code>&nbsp;up and you’re good to go!</p>



<p>Here’s how the&nbsp;<code>docker-compose</code>&nbsp;file looks like:</p>



<pre class="wp-block-code"><code>version: '3.8'

networks:
  metrics:
    name: bookstore-network
    
services:
  mssql:
    build: 
      context: ./scripts/sql
    ports:
      - "1433:1433"  
    environment:
      SA_PASSWORD: "P@ssw0rd?"
      ACCEPT_EULA: "Y"
    networks:
      - metrics

  prometheus:
    build: 
      context: ./scripts/prometheus
    depends_on:
      - app
    ports:
      - 9090:9090
    networks:
      - metrics

  grafana:
    build: 
      context: ./scripts/grafana
    depends_on:
      - prometheus
    ports:
      - 3000:3000
    networks:
      - metrics
  
  otel-collector:
    image: otel/opentelemetry-collector:0.60.0
    command: &#91;"--config=/etc/otel-collector-config.yaml"]
    volumes:
      - ./scripts/otel-collector/otel-collector-config.yaml:/etc/otel-collector-config.yaml
    ports:
      - "8888:8888" 
      - "8889:8889" 
      - "13133:13133"
      - "4317:4317"
    networks:
      - metrics

  app:
    build:
      context: ./
      dockerfile: ./src/BookStore.WebApi/Dockerfile
    depends_on:
      - mssql
      - otel-collector
    ports:
      - 5001:8080
    environment:
      ConnectionStrings__DbConnection: Server=mssql;Database=BookStore;User Id=SA;Password=P@ssw0rd?
      Otlp__Endpoint: http://otel-collector:4317
    networks:
      - metrics
</code></pre>



<h1 id="how-to-generate-metrics-to-test-the-grafana-dashboards"><strong>How to generate metrics to test the Grafana dashboards</strong></h1>



<p>In my <a href="https://github.com/vinaykarora/opentelemetry-tracing-demo">GitHub</a> repository you’ll also find a&nbsp;<code>seed-data.sh</code>&nbsp;Shell script, this script will invoke some endpoints of the BookStore API via cURL.</p>



<p><strong>To execute the&nbsp;<code>seed-data.sh</code>&nbsp;you need to have cURL installed on your local machine.</strong></p>



<p>The&nbsp;<code>seed-data.sh</code>&nbsp;script runs the following actions:</p>



<ul><li>Add 8 book categories.</li><li>Update 3 book categories.</li><li>Delete 2 book categories.</li><li>Add 17 books into the store.</li><li>Update 4 existing books.</li><li>Delete 2 existing books.</li><li>Add inventory for every book on the store.</li><li>Create 10 orders.</li><li>Cancel 3 existing orders.</li></ul>



<p>The purpose behind this script is to generate a decent amount of business metrics that later can be visualized in Grafana and Prometheus.</p>

		
		
			</div><!-- .entry-content .clear -->
</div>

	
</article><!-- #post-## -->


	<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="../getting-started-with-opentelemetry-metrics-in-net-part-1-key-concepts/index.html" rel="prev"><span class="ast-left-arrow">&larr;</span> Previous Post</a></div><div class="nav-next"><a href="../how-to-visualize-net-core-api-usage-with-prometheus-and-grafana-net-6/index.html" rel="next">Next Post <span class="ast-right-arrow">&rarr;</span></a></div></div>
	</nav>
<div id="comments" class="comments-area">

	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="index.html#respond" style="display:none;">Cancel Reply</a></small></h3><form action="https://vinayaroratech.com/wp-comments-post.php" method="post" id="ast-commentform" class="comment-form"><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><div class="ast-row comment-textarea"><fieldset class="comment-form-comment"><div class="comment-form-textarea ast-col-lg-12"><label for="comment" class="screen-reader-text">Type here..</label><textarea id="comment" name="comment" placeholder="Type here.." cols="45" rows="8" aria-required="true"></textarea></div></fieldset></div><div class="ast-comment-formwrap ast-row"><p class="comment-form-author ast-col-xs-12 ast-col-sm-12 ast-col-md-4 ast-col-lg-4"><label for="author" class="screen-reader-text">Name*</label><input id="author" name="author" type="text" value="" placeholder="Name*" size="30" aria-required='true' /></p>
<p class="comment-form-email ast-col-xs-12 ast-col-sm-12 ast-col-md-4 ast-col-lg-4"><label for="email" class="screen-reader-text">Email*</label><input id="email" name="email" type="text" value="" placeholder="Email*" size="30" aria-required='true' /></p>
<p class="comment-form-url ast-col-xs-12 ast-col-sm-12 ast-col-md-4 ast-col-lg-4"><label for="url"><label for="url" class="screen-reader-text">Website</label><input id="url" name="url" type="text" value="" placeholder="Website" size="30" /></label></p></div>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment &raquo;" /> <input type='hidden' name='comment_post_ID' value='950' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	
</div><!-- #comments -->
			</main><!-- #main -->
			
		
	</div><!-- #primary -->


	</div> <!-- ast-container -->
	</div><!-- #content -->
<footer
class="site-footer" id="colophon" itemtype="https://schema.org/WPFooter" itemscope="itemscope" itemid="#colophon">
			<div class="site-primary-footer-wrap ast-builder-grid-row-container site-footer-focus-item ast-builder-grid-row-3-equal ast-builder-grid-row-tablet-3-lheavy ast-builder-grid-row-mobile-full ast-footer-row-stack ast-footer-row-tablet-stack ast-footer-row-mobile-stack" data-section="section-primary-footer-builder">
	<div class="ast-builder-grid-row-container-inner">
					<div class="ast-builder-footer-grid-columns site-primary-footer-inner-wrap ast-builder-grid-row">
											<div class="site-footer-primary-section-1 site-footer-section site-footer-section-1">
							<aside
		class="footer-widget-area widget-area site-footer-focus-item" data-section="sidebar-widgets-footer-widget-1" aria-label="Footer Widget 1"				>
			<div class="footer-widget-area-inner site-info-inner"><section id="text-3" class="widget widget_text"><h2 class="widget-title">About Me</h2>			<div class="textwidget"><p>Vinay is full-stack developer and architect with 10+ years of experience in various technologies—including the entire Microsoft stack .NET Framework, .NET Core, Microservices, Blazor, Azure, Aws, NodeJs, Python, MongoDb, and front-end technologies (Angular and React).</p>
</div>
		</section></div>		</aside>
						</div>
											<div class="site-footer-primary-section-2 site-footer-section site-footer-section-2">
							<aside
		class="footer-widget-area widget-area site-footer-focus-item" data-section="sidebar-widgets-footer-widget-2" aria-label="Footer Widget 2"		>
			<div class="footer-widget-area-inner site-info-inner"><section id="media_gallery-1" class="widget widget_media_gallery"><h2 class="widget-title">My Projects</h2><div id='gallery-1' class='gallery galleryid-950 gallery-columns-3 gallery-size-medium'><figure class='gallery-item'>
			<div class='gallery-icon landscape'>
				<a href='../../wp-content/uploads/2021/06/karbit.png'><img width="300" height="117" src="../../wp-content/uploads/2021/06/karbit-300x117.png" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://vinayaroratech.com/wp-content/uploads/2021/06/karbit-300x117.png 300w, https://vinayaroratech.com/wp-content/uploads/2021/06/karbit.png 400w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</div></figure><figure class='gallery-item'>
			<div class='gallery-icon landscape'>
				<a href='../../wp-content/uploads/2021/06/Symba.png'><img width="300" height="106" src="../../wp-content/uploads/2021/06/Symba-300x106.png" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://vinayaroratech.com/wp-content/uploads/2021/06/Symba-300x106.png 300w, https://vinayaroratech.com/wp-content/uploads/2021/06/Symba.png 398w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</div></figure><figure class='gallery-item'>
			<div class='gallery-icon landscape'>
				<a href='../../wp-content/uploads/2021/06/Automotivemastermind-Logo.jpg'><img width="300" height="150" src="../../wp-content/uploads/2021/06/Automotivemastermind-Logo-300x150.jpg" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://vinayaroratech.com/wp-content/uploads/2021/06/Automotivemastermind-Logo-300x150.jpg 300w, https://vinayaroratech.com/wp-content/uploads/2021/06/Automotivemastermind-Logo.jpg 600w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</div></figure><figure class='gallery-item'>
			<div class='gallery-icon landscape'>
				<a href='../../wp-content/uploads/2021/06/TrekIT.png'><img width="256" height="256" src="../../wp-content/uploads/2021/06/TrekIT.png" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://vinayaroratech.com/wp-content/uploads/2021/06/TrekIT.png 256w, https://vinayaroratech.com/wp-content/uploads/2021/06/TrekIT-150x150.png 150w" sizes="(max-width: 256px) 100vw, 256px" /></a>
			</div></figure><figure class='gallery-item'>
			<div class='gallery-icon landscape'>
				<a href='../../wp-content/uploads/2021/06/Oasis-360-1120x480-1.png'><img width="300" height="129" src="../../wp-content/uploads/2021/06/Oasis-360-1120x480-1-300x129.png" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://vinayaroratech.com/wp-content/uploads/2021/06/Oasis-360-1120x480-1-300x129.png 300w, https://vinayaroratech.com/wp-content/uploads/2021/06/Oasis-360-1120x480-1-1024x439.png 1024w, https://vinayaroratech.com/wp-content/uploads/2021/06/Oasis-360-1120x480-1-768x329.png 768w, https://vinayaroratech.com/wp-content/uploads/2021/06/Oasis-360-1120x480-1.png 1120w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</div></figure><figure class='gallery-item'>
			<div class='gallery-icon landscape'>
				<a href='../../wp-content/uploads/2021/06/us-bank.jpg'><img width="200" height="200" src="../../wp-content/uploads/2021/06/us-bank.jpg" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://vinayaroratech.com/wp-content/uploads/2021/06/us-bank.jpg 200w, https://vinayaroratech.com/wp-content/uploads/2021/06/us-bank-150x150.jpg 150w" sizes="(max-width: 200px) 100vw, 200px" /></a>
			</div></figure>
		</div>
</section></div>		</aside>
						</div>
											<div class="site-footer-primary-section-3 site-footer-section site-footer-section-3">
							<aside
		class="footer-widget-area widget-area site-footer-focus-item" data-section="sidebar-widgets-footer-widget-3" aria-label="Footer Widget 3"		>
			<div class="footer-widget-area-inner site-info-inner"><section id="text-5" class="widget widget_text"><h2 class="widget-title">Contact</h2>			<div class="textwidget"><p>I am available for hire for remote, freelance software development and technical writing projects.</p>
</div>
		</section><section id="nav_menu-14" class="widget widget_nav_menu"><nav class="menu-contact-container" aria-label="Menu"><ul id="menu-contact" class="menu"><li id="menu-item-493" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-493"><a href="#" class="menu-link">179/5 New Friends Colony, Gurgaon, HR 122103 India</a></li>
<li id="menu-item-494" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-494"><a href="#" class="menu-link">+91 931 097 7171</a></li>
<li id="menu-item-495" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-495"><a href="#" class="menu-link">va@vinayaroratech.com</a></li>
</ul></nav></section></div>		</aside>
						</div>
										</div>
			</div>

</div>
<div class="site-below-footer-wrap ast-builder-grid-row-container site-footer-focus-item ast-builder-grid-row-2-equal ast-builder-grid-row-tablet-2-equal ast-builder-grid-row-mobile-full ast-footer-row-stack ast-footer-row-tablet-stack ast-footer-row-mobile-stack" data-section="section-below-footer-builder">
	<div class="ast-builder-grid-row-container-inner">
					<div class="ast-builder-footer-grid-columns site-below-footer-inner-wrap ast-builder-grid-row">
											<div class="site-footer-below-section-1 site-footer-section site-footer-section-1">
								<div class="ast-builder-layout-element ast-flex site-footer-focus-item ast-footer-copyright" data-section="section-footer-builder">
				<div class="ast-footer-copyright"><p>Copyright © 2023 Vinay Arora</p>
</div>			</div>
						</div>
											<div class="site-footer-below-section-2 site-footer-section site-footer-section-2">
							<div class="footer-widget-area widget-area site-footer-focus-item ast-footer-html-1" data-section="section-fb-html-1">
			<div class="ast-header-html inner-link-style-"><div class="ast-builder-html-element"><p>Powered by Vinay Arora</p>
</div></div>		</div>
						</div>
										</div>
			</div>

</div>
	</footer><!-- #colophon -->
	</div><!-- #page -->
<script src='../../wp-includes/js/comment-reply.mind988.js?ver=5.7.8' id='comment-reply-js'></script>
<script id='astra-theme-js-js-extra'>
var astra = {"break_point":"921","isRtl":""};
</script>
<script src='../../wp-content/themes/astra/assets/js/minified/frontend.minb045.js?ver=3.4.8' id='astra-theme-js-js'></script>
<script src='../../wp-includes/js/wp-embed.mind988.js?ver=5.7.8' id='wp-embed-js'></script>
			<script>
			/(trident|msie)/i.test(navigator.userAgent)&&document.getElementById&&window.addEventListener&&window.addEventListener("hashchange",function(){var t,e=location.hash.substring(1);/^[A-z0-9_-]+$/.test(e)&&(t=document.getElementById(e))&&(/^(?:a|select|input|button|textarea)$/i.test(t.tagName)||(t.tabIndex=-1),t.focus())},!1);
			</script>
				</body>

<!-- Mirrored from vinayaroratech.com/dotnet/getting-started-with-opentelemetry-metrics-in-net-part-2-instrumenting-the-bookstore-api/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 08:24:21 GMT -->
</html>
